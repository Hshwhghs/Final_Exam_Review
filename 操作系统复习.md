## 第一章

### 1.1操作系统的目标和作用

#### 1.1.1操作系统的目标

1. 方便性

2. 有效性

3. 开放性

4. 可扩充性
#### 1.1.2操作系统的作用
1. os作为用户与计算机硬件系统之间的接口
2. os作为计算机资源的管理者（处理器，存储器，I/O设备以及文件）
3. os实现了对计算机资源的抽象
#### 1.1.3推动操作系统发展的主要动力
1. 不断提高计算机资源利用率
2. 方便用户
3. 器件的不断更新迭代
4. 计算机体系结构的不断发展
5. 不断提出新的应用需求

#### 1.2.1未配置操作系统的计算机系统

1. 人工操作方式
2. 脱机输入输出方式：事先将装有用户程序和数据的纸带装入纸带输入机，在外围机的作用下，把纸带的数据输入到磁带上。当CPU需要这些数据时，再从磁带上高速的掉入内存。类似的，当CPU需要输出时，可先由CPU把数据直接从内存高速地输入到磁带上，然后在另一台外围机的控制下，再将磁带上的结果输出到外部设备。
- 优点：减少了CPU的空闲时间，提高了I/O速度。

#### 1.2.2单道批处理系统

1. 单道批处理：系统对作业的处理时成批进行的，但在内存中只保持一道作业。

   - 单道批处理是为了解决人机矛盾和CPU与I/O设备速度不匹配

   - 批处理系统旨在提高系统资源的利用率和系统吞吐量

 - 缺点：系统中的资源得不到充分利用内存中仅有一道程序，该程序发出I/O请求时，CPU便处于等待状态，必须在I/O完成后才可继续执行，又由I/O设备低速性，更使CPU利用率显著降低

#### 1.2.3多道批处理系统

多道批处理系统：将待运行作业排成一个队列（后备队列），按照一定调度算法选择若干作业运行，这样当一个程序执行I/O操作时，另一个程序便可调度执行。
- 优点：
1. 系统资源利用率高，使得多道程序交替进行，CPU处于忙碌；内存装入多道程序还可以提高内存利用率，此外还可以提高I/O设备的利用率
2. 系统吞吐量大（CPU和其他资源保持忙碌状态，仅当作业完成或者运行不下去才进行切换，系统开销小）
- 缺点：
1. 平均周转时间长（作业排队久）

2. 无交互能力（一旦提交作业用户都不能于自己的作业进行交互）

#### 1.2.4分时系统-满足用户对人机交互的需求
1. 分时系统的引入
-概念：在一台主机上连接了多个配有显示器和键盘的终端并由此组成的系统，该系统允许多个用户同时通过自己的终端，以交互方式使用计算机，共享主机中的资源。
- 需求：人机--交互，共享主机。
2. 实现关键：及时接收，及时处理（作业直接进入内存，采用轮转方式运行）（即在短时间内所有用户程序都能运行）
3. 特征（与多道批处理系统相比）
     1. 多路性
     2. 独立性
     3. 及时性
     4. 交互性
#### 1.2.5实时系统
**概念**：系统能够及时响应外部时间的请求，在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致的运行。

**类型**：

1. 工业控制系统
2. 信息查询系统
3. 多媒体系统
4. 嵌入式系统

**特征：**
多路性，独立性，及时性，交互性，可靠性



#### 1.2.6 微机操作系统的发展

1. 单用户单任务操作系统
2. 单用户多任务操作系统
3. 多用互多任务操作系统


### 1.3操作系统特性

**并发、共享、虚拟、异步**

1. 并发与并行：后者是多个事件在同一时刻发生，前者指多个事件在同一时间间隔内发生

2. 共享（互斥、同时访问（宏观同时，微观交替））

3. 虚拟：指通过某种技术将一个物理实体变成若干逻辑上的对应物的功能。

   - 时分复用，即多道程序技术（虚拟处理机，虚拟设备），提高处理机的利用率

   - 空分复用，提高内存的利用率

 4. 异步：由于资源限制，进程的执行通常都不是一气呵成，而是走走停停的方式。
 #### 1.4.1操作系统的主要功能
 1. 处理机管理
 - 进程控制
 - 进程同步
 - 进程通信
 - 调度（进程和作业）
 2. 存储器管理
 - 内存分配与回收
 - 内存保护
 - 地址映射
 - 内存扩充（虚拟存储技术）
 3. 设备管理
 - 缓冲管理(缓解CPU与I/O速度不匹配问题)
 - 设备分配
 - 设备处理（相关程序又称为驱动程序），完成CPU和设备控制器之间的通信，即由CPU向设备控制器发送I/O命令，完成指定操作。
 4. 文件管理
 - 文件存储空间的管理：

 - 目录管理

 - 文件的读写保护

5. 用户接口:程序接口和用户接口

#### 1.4.6现代操作系统
- 系统安全
- 网络的功能和服务
- 支持多媒体
#### 1.5.1os结构
- 无结构os
- 模块化结构os
- 分层式结构os
#### 1.5.4微内核os
- 建立在模块化，层次化之上
优点
1. 提高了系统的可扩展性
2. 增强了系统的可靠性
3. 可移植性强
4. 提供了对分布式系统的支持
5. 融入了面向对象
#第二章 进程的描述与控制
#### 2.1.2顺序执行特点
顺序性、封闭性（资源独占）、可再现性
####2.1.3并发执行

间断性、失去封闭性（资源共享）、不可再现性（和执行速度有关）

### 2.2进程的描述





# 第四章--存储器管理



#### 4.2程序的装入和链接
1. 程序运行的步骤：编译，链接，装入

**程序装入：**

1. 绝对装入方式（只适用于单道程序环境，程序中的地址即为实际物理地址）

2. 可重定位装入方式，又叫静态重定位，即地址变换在程序装入进行，以后不再改变。

3. 动态运行时装入（程序运行时才修改地址，需要借助重定位寄存器，允许程序在内存中位置发生改变）

**程序链接**

1. 静态链接

2. 装入时链接（边装入边链接）

   - 便于修改和更新
   - 便于实现对目标块的共享

3. 运行时动态链接

   - 节约内存（没有用到的目标块不会调入内存链接到程序）

   - 运行效率高 

### 4.3连续分配存储管理方式
- 单一连续分配（单道程序环境，整个内存由一道程序独占）
- 固定分区分配（分区相等[缺乏灵活性]或不等，简单但容易有内部碎片，适用于作业大小和频率已知的情况）
- 动态分区分配（空闲分区表，空闲分区链）
- 动态可重定位分区分配(增加了紧凑技术）
####4.3.4基于顺序搜索的动态分区分配
1. 首次适应（FF）
- 按照空闲分区地址递增排序
- 优点：尽可能利用低地址的小分区，使得高地址部分有较大的空闲分区。
- 缺点：低地址不断划分，形成很多小碎片。此外每次都是从低地址开始查找，增加了查询开销。
2. 循环首次适应（NF）
- 按照空闲分区地址递增排序
- 优点：使空闲分区更均匀，减少了查找空闲分区开销
- 缺点：缺少较大的空闲分区
3. 最佳适应(BF)
- 按照分区大小递增排序
- 优点：每次选择最小的满足的分区，不至于毁掉较大的分区
- 缺点：留下了许多碎片，造成内存浪费
4. 最坏适应(WF)
- 按照分区大小递减排序
- 优点：剩下的空闲分区不至于太小，产生碎片几率小。
- 缺点：缺乏大的空闲分区
####4.3.5基于索引的动态分区分配
1. 快速适应
2. 伙伴系统
3. 哈希算法
####4.3.6动态可重定位分区分配
- 特点：引入了紧凑技术，将碎片紧凑起来利用（通过移动作业，把多个分散的小分区变成大分区）
- 用到了重定位寄存器，其他和动态分区分配类似
### 4.4对换
**概念：**把内存中暂时不能运行或者暂时不用运行的程序或者数据换到外存，以便腾出足够的空间，再把已具备条件的进程或者进程中需要的程序或者数据换入内存。
**优点**可以直接提高内存的利用率和系统的吞吐量。
**类型**
1. 整体对换
2. 页面（分段）对换
通常把磁盘分为文件区（离散）和对换区（连续）
对文件区：提高文件存储空间利用率》提高文件的访问速度
对对换区：提高进程换入换出？提高文件存储空间的利用率

###4.5分页式存储管理
**页表：**实现页号到物理块号的地址映射（大多在内存）

**地址变换机构：**借助页表完成逻辑地址到物理地址的转换

**页表寄存器：**用来存放页表在内存中的位置，**单处理机虽然可以运行多个进程，但只需要一个页表寄存器**

**越界保护**，**快表**

### 4.6 分段式存储管理

**引入原因**：满足用户在编程和使用上的多方面要求。

1. 方便编程
2. 信息共享
3. 信息保护
4. 动态增长
5. 动态链接
分段和分页的区别：
1. 页是信息的物理单位，分页只是系统管理上的需要，对用户不可见；而段是信息的逻辑单位，通常包含一组完整的信息，目的在于更好的满足用户需求。
2. 页大小固定且由系统决定，而段大小在编译是根据信息性质来划分。
3. 分页用户的程序地址空间是一维的，而分段中是二维的。
#### 4.6.3信息共享
分段的优点之一：便于实现信息共享
可重入代码：是一种允许多个进程同时访问的代码，为了使各个进程运行的代码结果相同，绝对不允许任何进程修改可重入代码
####4.6.4段页式存储管理
- 先分段，每一段再按页存储
- 地址：段号（段表存的是页表大小和页表始址），段内页号，页内地址
- 需要三次访问内存

# 第五章--虚拟存储器
**常规存储器特征**：一次性（将所有页一次性调入内存，导致大作业无法运行）、驻留性

**局部性原理：**在一较短时间内，程序的执行局限于某个部位，相应地，它所访问的存储空间也局限于某个区域

#### 5.1.2定义和特征

**定义**：具有请求调入功能和置换功能，能够从逻辑上对内存容量加以扩充的一种存储器系统

**特征**

- 多次性

- 对换性

- 虚拟性

- 离散性
####5.1.3虚拟存储器的实现方法
1. 分页请求系统
- 在分页系统上增加了请求调页和页面置换

- 硬件支持(分段类似)
     1. 请求分页的页表机制（增加了状态位P（页面置换算法参考），访问字段A，修改位M以及外存地址（该页在外存中的地址，供调页时参考））
     
     2. 缺页中断机构（立即中断，保证及时调入页面，一条指令可能多次缺页中断）
     
     3. 地址变换机构

2. 请求分页的内存分配
    1. 最小物理块：可变与固定，局部与全局
    2. 分配策略
    - 固定分配局部置换
    - 可变分配全局置换
    - 可变分配局部置换
    3. 物理块的分配算法：
    - 平均分配
    - 按比例分配
    - 考虑优先权的分配
  3. 页面调入策略
  - 何时调入

  - 何处调入

  - 如何调入

  - 缺页率

页面置换算法：
- FIFO
- LRU
- NRU
- LFU
- CLOCK(近似LRU)

EAT：$设a表示命中率，f表示缺页率，\epsilon表示缺页中断处理时间，\lambda表表示查找快表时间则$
$$
EAT=\lambda+at+(1-a)[(1-f)(\lambda+t)+f(\epsilon+\lambda+t)+t]
$$
影响缺页次数的因素

### 5.4抖动
**影响缺页次数的因素**

1. 分配给进程的物理块数

2. 页本身大小

3. 页面置换算法

4. 程序的编制方法

**抖动**：页面在内存与外存之间频繁调度，以致于调度页面所需时比进程实际运行时间还多，导致系效率急剧下降，甚至导致系统崩溃的现象。   

**抖动原因**:同时在系统中运行的进程太多，由此分配给每一个进程的物理块太少或者页面算法不合理，不能满足正常的运行需求，致使每个进程在运行时，频繁的出现缺页，必须请求系统将所缺之页调入内存。
**解决办法**：

1. 采用局部置换的方法
2. 把工作集算法融入到处理机调度中
3. 利用L=S准则，（平均等待时间L=缺页平均时间）
4. 选择暂停的进程，减少运行的进程数
4. 增大内存

### 5.6请求分段

多了存取方式和增补位，且优点是便于实现分段的共享与保护



# 第六章--I/O设备管理

####6.1 I/O系统的功能

1. 隐藏物理设备的细节
2. 与设备的无关性
3. 提高处理机和I/O的利用率
4. 对I/O设备进行控制
5. 确保设备的正确共享
6. 错误处理

设备控制器

内存映像：I/O与存储器统一编址

#### 6.1.2I/O系统的软件层次

1. 用户层I/O软件

2. 设备独立性软件

3. 设备驱动性软件

4. 中断处理程序

####6.1.3I/O系统接口
1. 块设备接口
2. 流设备接口
3. 网络通信接口

#### 6.2.4 I/O通道

I/O通道：一种特殊的处理机(弱鸡版CPU)，具有执行I/O指令的能力，并通过执行通道程序来控制I/O操作（出于设备控制器与CPU之间）

**特点**：指令单一，没有自己的内存

**优点**：CPU，通道，I/O设备可并行运行，资源利用率高

**类型**：

- 字节多路通道(按字节方式工作，子通道按时间片轮转共享主通道，不适用于高速设备)
- 数组选择通道(利用率低，按数组方式进行传送，但只有一个分配性子通道)
- 数组多路通道（利用率高，按数组方式进行传送）

**I/O通道瓶颈问题**：价格贵，数量少，导致系统吞吐量下降
**解决：**增加设备到主机间的通路，即一个设备连多个控制器，一个控制器连多个通道

#### 6.2 I/O控制方式

1. 程序I/O（轮询）（容易出于忙等，CPU极大浪费）

2. 中断驱动（一个字节中断一次）

3. DMA控制方式（按块传送）
   **DMA控制器：**
   
   1. 命令/状态寄存器CR
   2. 内存地址寄存器MAR
   3. 数据寄存器DR
   4. 数据计数器DC
   
4. I/O通道控制方式（进一步减少CPU干预，多组块）

   

### 6.3缓冲管理

**目的**

1. 缓和CPU与I/O设备之间的速度不匹配

2. 减少对CPU的中断频率

3. 提高CPU与I/O设备之间的并行性

4. 解决数据粒度不匹配的问题
单缓冲：系统对每一块数据的平均处理时间为max(C,T)+M
双缓冲（缓冲对换）：系统对每一块数据的平均处理时间为max(C,T)（粗略，准确为max(C+M,T)）
两台机器同时配备双缓冲，可以实现双向数据传送
多缓冲(解决双缓冲速度差异大的问题）：使用多个缓冲，多个指针
缓冲池：提高缓冲区的利用率，在池中设置了若干个可供进程共享的缓冲区 （包含了一组管理的数据结构以及一组操作函数用于管理缓冲区）









